import{r as x,j as e,b as $,a as I,i as q,k as H,L as D,z as j,l as O,m as T,n as F}from"./index-CVQA_-Qn.js";import{b as X}from"./booksAction-RIx05uIB.js";import{N as Y}from"./Navbar-YDu-ONv3.js";import{I as G}from"./image-72muM-Ku.js";import{c as y}from"./createLucideIcon-BOWIOHBy.js";import{a as U}from"./requestActions-CaDZSxz5.js";import{X as V}from"./x-VhSREFwM.js";import{S as W}from"./star-BW1rJTb0.js";import{M as J}from"./map-pin-316Rjvs2.js";import{C as K}from"./chevron-down-B_l8m3Vj.js";import{C as _}from"./circle-check-big-B67mn1xD.js";import{C as Q}from"./calendar-Cmvgkv4d.js";import{H as Z}from"./heart-DgzIgv4v.js";import{S as ee}from"./send-_gn5XwLJ.js";import{B as se}from"./book-open-C92JuBiy.js";import"./check-check-Bt3O84_i.js";import"./menu-CpxPV_BY.js";import"./user-DjW21Lp-.js";const te=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],ae=y("book",te);const re=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],oe=y("chevron-left",re);const le=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ne=y("chevron-right",le);const ie=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],ce=y("gift",ie);const de=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],R=y("repeat",de),xe=({src:s,width:l="auto",height:o="100%",magnifierHeight:c=150,magnifierWidth:n=150,zoomLevel:d=2})=>{const[t,h]=x.useState(!1),[[w,m],v]=x.useState([0,0]),[[N,k],i]=x.useState([0,0]),C=r=>{const p=r.currentTarget,{width:u,height:g}=p.getBoundingClientRect();i([u,g]),h(!0)},B=r=>{r.preventDefault(),h(!1)},f=r=>{const p=r.currentTarget,{top:u,left:g}=p.getBoundingClientRect(),S=r.pageX-g-window.pageXOffset,M=r.pageY-u-window.pageYOffset;v([S,M])};return e.jsxs("div",{style:{position:"relative",height:o,width:l},children:[e.jsx("img",{src:s,style:{height:o,width:l},onMouseEnter:C,onMouseLeave:B,onMouseMove:f,alt:"Product"}),e.jsx("div",{style:{display:t?"":"none",position:"absolute",pointerEvents:"none",height:`${c}px`,width:`${n}px`,top:`${m-c/2}px`,left:`${w-n/2}px`,opacity:"1",border:"1px solid lightgray",borderRadius:"50%",backgroundColor:"white",backgroundImage:`url('${s}')`,backgroundRepeat:"no-repeat",backgroundSize:`${N*d}px ${k*d}px`,backgroundPositionX:`${-w*d+n/2}px`,backgroundPositionY:`${-m*d+c/2}px`}})]})},he=({images:s})=>{const[l,o]=x.useState("");if(x.useEffect(()=>{s&&s.length>0&&o(s[0])},[s]),!s||s.length===0)return null;const c=s.indexOf(l),n=()=>{const t=(c+1)%s.length;o(s[t])},d=()=>{const t=(c-1+s.length)%s.length;o(s[t])};return e.jsxs("div",{className:"flex flex-col gap-4 font-jakarta",children:[e.jsxs("div",{className:"relative w-full h-[400px] md:h-[500px] bg-gray-100 rounded-3xl overflow-hidden group shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4",children:e.jsx(xe,{src:l,alt:"Book Image",className:"max-h-full max-w-full object-contain rounded-2xl"})}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/75 backdrop-blur-md text-white px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-2 shadow-lg z-10",children:[e.jsx(G,{size:14,className:"text-orange-500"}),e.jsxs("span",{children:[c+1," ",e.jsx("span",{className:"text-gray-400",children:"/"})," ",s.length]})]}),s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),d()},className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-white/90 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white text-gray-800",children:e.jsx(oe,{size:20})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n()},className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-white/90 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white text-gray-800",children:e.jsx(ne,{size:20})})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 hide-scrollbar px-1",children:s.map((t,h)=>e.jsxs("button",{onClick:()=>o(t),className:`
              relative flex-shrink-0 w-20 h-20 rounded-xl overflow-hidden transition-all duration-300
              ${l===t?"ring-2 ring-orange-500 ring-offset-2 opacity-100 scale-95":"opacity-60 hover:opacity-100 hover:scale-105 ring-1 ring-gray-200"}
            `,children:[e.jsx("img",{src:t,alt:`View ${h+1}`,className:"w-full h-full object-cover"}),l===t&&e.jsx("div",{className:"absolute inset-0 bg-orange-500/10"})]},h))})]})},ge=({isOpen:s,onClose:l,onSelectBook:o})=>{const{bookCollection:c,isAuthorized:n}=$(t=>t.users),d=I();return x.useEffect(()=>{s&&n&&d(q())},[s,n,d]),s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Select a Book to Swap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a book from your collection to offer."})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(V,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c&&c.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:c.map(t=>e.jsxs("div",{onClick:()=>o(t),className:"cursor-pointer group flex gap-4 p-3 rounded-2xl border border-gray-200 hover:border-orange-500 hover:bg-orange-50 transition-all",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:t.coverImageUrl||"https://placehold.co/100x150?text=No+Cover",alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h4",{className:"font-bold text-gray-900 line-clamp-1 group-hover:text-orange-700",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500",children:t.author}),e.jsx("span",{className:"mt-2 inline-flex items-center text-[10px] font-bold uppercase tracking-wider text-orange-600 bg-white px-2 py-1 rounded-full border border-orange-100",children:"Select"})]})]},t._id))}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"No books found"}),e.jsx("p",{className:"text-gray-500",children:"You haven't added any books to your collection yet."})]})}),e.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50 rounded-b-3xl",children:e.jsx("button",{onClick:l,className:"w-full py-3 font-bold text-gray-600 hover:text-gray-900 transition-colors",children:"Cancel"})})]})}):null},pe=({book:s})=>{const{title:l,author:o,status:c,availabilityType:n=[],genre:d=[],owner:t,location:h,description:w}=s,[m,v]=x.useState(""),[N,k]=x.useState(""),[i,C]=x.useState(""),[B,f]=x.useState(!1),[r,p]=x.useState(null),{user:u}=$(a=>a.users),g=$(a=>H(a).has(s._id)),S=I(),M=a=>{switch(a?.toLowerCase()){case"swap":return{label:"Request Swap",icon:e.jsx(R,{className:"w-5 h-5"})};case"borrow":return{label:"Request to Borrow",icon:e.jsx(se,{className:"w-5 h-5"})};case"donate":return{label:"Claim as Free",icon:e.jsx(ce,{className:"w-5 h-5"})};default:return{label:"Send Request",icon:e.jsx(ee,{className:"w-5 h-5"})}}},z=a=>{a.preventDefault(),S(O(s._id,g))},L=a=>{p(a),f(!1),j.success(`${a.title} selected for swap!`)},P=()=>{if(!u)return j.error("Please login to send a request!");if(!i)return j.error("Please select an action type!");if(!m.trim())return j.error("Please write a note to the owner!");if(i.toLowerCase()==="swap"&&!r)return j.error("Please select a book from your collection to Swap!");const a={bookId:s._id,type:i,offeredBookId:i.toLowerCase()==="swap"?r._id:null,dueDate:N,notes:m};S(U(a)).then(()=>{v(""),k(""),p(null),C("")})},{label:E,icon:A}=M(i);return e.jsxs("div",{className:"space-y-8 font-jakarta",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-3 py-1 text-xs font-semibold uppercase tracking-wider text-teal-800 bg-teal-100 rounded-full",children:c}),n.map((a,b)=>e.jsx("span",{className:"px-3 py-1 text-xs font-semibold uppercase tracking-wider text-orange-800 bg-orange-100 rounded-full",children:a},b))]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 leading-tight",children:l}),e.jsxs("p",{className:"text-xl text-gray-600 font-medium",children:["by ",o]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-2",children:[e.jsx("span",{className:"font-bold text-xs text-gray-400 uppercase tracking-widest mr-2",children:"GENRE"}),d.map((a,b)=>e.jsx("span",{className:"px-4 py-1.5 text-sm border border-gray-200 bg-white rounded-full text-gray-700 shadow-sm",children:a},b))]})]}),e.jsx("div",{className:"p-5 bg-white border border-gray-100 rounded-3xl shadow-sm flex flex-col sm:flex-row gap-5 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t?.avatar?.url||t?.avatar||`https://ui-avatars.com/api/?name=${t?.name}`,alt:t?.name,className:"w-14 h-14 rounded-full border-2 border-white shadow-sm"}),e.jsxs("div",{children:[e.jsx(D,{to:`/profile/${t._id}`,className:"font-bold text-lg text-gray-900 ",children:t?.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mt-0.5",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"font-semibold text-black mr-1",children:t?.ratingStats?.avgRating||"New"}),e.jsxs("span",{className:"text-gray-400",children:["(",t?.ratingStats?.totalRatings||0," reviews)"]})]})]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 pl-1",children:[e.jsx(J,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsxs("span",{children:[h?.city,", ",h?.state]})]})]})}),e.jsxs("div",{className:"space-y-6 bg-white p-6 rounded-3xl border border-gray-100 shadow-sm relative z-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-gray-700 uppercase tracking-wide ml-1",children:"Select Action"}),e.jsxs("details",{className:"group relative w-full",children:[e.jsxs("summary",{className:"list-none cursor-pointer w-full p-4 flex items-center justify-between rounded-2xl border-2 border-gray-100 bg-gray-50 hover:border-gray-300 transition-all active:scale-[0.99] focus:outline-none",children:[e.jsx("span",{className:`font-semibold truncate pr-4 ${i?"text-gray-900":"text-gray-400"}`,children:i||"Choose action..."}),e.jsx(K,{className:"text-gray-400 w-5 h-5 transition-transform duration-300 group-open:rotate-180 flex-shrink-0"})]}),e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-full z-50 bg-white border border-gray-100 rounded-2xl shadow-xl overflow-hidden animate-in fade-in zoom-in duration-100 origin-top",children:[e.jsx("div",{className:"p-3 bg-gray-50 border-b border-gray-100",children:e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider whitespace-normal",children:"Choose how you want to get this book..."})}),n.map(a=>e.jsxs("div",{onClick:b=>{C(a),p(null),b.currentTarget.closest("details").removeAttribute("open")},className:"p-4 hover:bg-orange-50 cursor-pointer font-medium text-gray-700 hover:text-orange-700 flex items-center justify-between transition-colors border-b border-gray-50 last:border-0",children:[e.jsx("span",{className:"truncate",children:a}),i===a&&e.jsx(_,{className:"w-4 h-4 text-orange-500 flex-shrink-0 ml-2"})]},a))]})]})]}),i&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.toLowerCase()!=="donate"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-gray-700 uppercase tracking-wide ml-1 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," Due Date"]}),e.jsx("input",{type:"date",value:N,min:new Date().toISOString().split("T")[0],onChange:a=>k(a.target.value),className:"w-full p-3 rounded-2xl border-2 border-gray-100 focus:border-orange-500 focus:outline-none bg-white"})]}),e.jsxs("div",{className:`space-y-2 ${i.toLowerCase()==="donate"?"md:col-span-2":""}`,children:[e.jsx("label",{className:"text-sm font-bold text-gray-700 uppercase tracking-wide ml-1",children:"Message"}),e.jsx("input",{type:"text",value:m,onChange:a=>v(a.target.value),placeholder:"Short note to owner...",className:"w-full p-3 rounded-2xl border-2 border-gray-100 focus:border-orange-500 focus:outline-none bg-white"})]})]}),i.toLowerCase()==="swap"&&e.jsxs("div",{onClick:()=>f(!0),className:`
                    cursor-pointer p-4 rounded-2xl border-2 border-dashed transition-all flex items-center justify-between
                    ${r?"border-green-500 bg-green-50":"border-orange-300 bg-orange-50 hover:bg-orange-100 hover:border-orange-400"}
                `,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:`p-2 rounded-full flex-shrink-0 ${r?"bg-green-200":"bg-orange-200"}`,children:r?e.jsx(_,{className:"w-5 h-5 text-green-700"}):e.jsx(R,{className:"w-5 h-5 text-orange-700"})}),e.jsxs("div",{className:"truncate",children:[e.jsx("p",{className:`font-bold truncate ${r?"text-green-800":"text-orange-900"}`,children:r?"Book Selected for Swap":"Select Book to Exchange"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r?r.title:"Click here to choose from your collection"})]})]}),r&&e.jsx("span",{className:"text-xs font-bold text-green-700 bg-green-200 px-2 py-1 rounded-md flex-shrink-0",children:"Change"})]}),e.jsxs("button",{onClick:P,disabled:i.toLowerCase()==="swap"&&!r,className:`
                    w-full font-bold py-4 px-6 rounded-2xl transition-all shadow-lg flex items-center justify-center gap-2
                    ${i.toLowerCase()==="swap"&&!r?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-orange-500 hover:bg-orange-600 active:scale-95 text-white shadow-orange-200"}
              `,children:[A,E]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"flex items-center gap-2 text-gray-500 font-semibold hover:text-red-500 transition-colors",onClick:z,children:[e.jsx(Z,{color:g?"red":"gray",fill:g?"red":"none",className:"w-5 h-5"}),g?"Added to Wishlist":"Add to Wishlist"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 uppercase tracking-wide",children:"Synopsis"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:w})]}),e.jsx(ge,{isOpen:B,onClose:()=>f(!1),userBooks:u?.books||[],onSelectBook:L})]})},me=({books:s})=>{if(!s)return null;const l=s.slice(0,4);return e.jsxs("div",{className:"space-y-6 font-jakarta pb-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-l-4 border-orange-500 pl-4",children:"Related Books"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:l.map(o=>e.jsx(D,{to:`/books/${o._id}`,children:e.jsxs("div",{className:"group relative bg-white rounded-2xl overflow-hidden h-72 shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100",children:[e.jsx("img",{src:o.coverImageUrl,alt:o.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-4",children:e.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:o.title})})]})},o._id))})]})},ze=()=>{const{id:s}=T(),l=I(),{bookDetails:o,loadingCurrentBook:c}=$(h=>h.books),{book:n,related:d}=o;if(x.useEffect(()=>{s&&l(X(s))},[l,s]),!n||c)return e.jsx(F,{fullScreen:!0});const t=[n.coverImageUrl,...n.additionalImages||[]];return e.jsxs("div",{className:"w-full min-h-screen px-4 lg:px-12 selection:bg-orange-100 selection:text-orange-900 bg-[#f8f5f0] pb-12",children:[e.jsx(Y,{}),e.jsxs("div",{className:"max-w-7xl mx-auto mt-8 space-y-16",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-12",children:[e.jsx("div",{className:"lg:col-span-5",children:e.jsx(he,{images:t})}),e.jsx("div",{className:"lg:col-span-7",children:e.jsx(pe,{book:n})})]}),d&&d.length>0&&e.jsx("div",{children:e.jsx(me,{books:d})})]})]})};export{ze as default};
