import{a as k,r as m,j as e,L as S,b as y,w as b,x}from"./index-D6hQ08Y0.js";import{b as j,c as g,d as N}from"./requestActions-C7mLKN69.js";import{u as q}from"./index.esm-DqYK3Ucx.js";import{g as R,c as v}from"./constants-DytKgnBF.js";import{c as p}from"./createLucideIcon-C9Hrp4nZ.js";import{M as w}from"./map-pin-B2ya93t5.js";import{M as A}from"./message-square-DSxsq7s0.js";import{C as _}from"./check-DIomLv4k.js";import{X as E}from"./x-BL0ellVK.js";import{E as U}from"./ellipsis-BXvt-ULw.js";import{A as M}from"./clock-JQ9xzxrc.js";import{N as L}from"./Navbar-B8S6qRoR.js";import{A as $}from"./arrow-up-right-DgZ_bVwA.js";import"./book-open-CQ8IbAVz.js";import"./check-check-CE3MAPcn.js";import"./circle-check-big-D7MaoHrP.js";import"./star-DZToScwE.js";import"./menu-BUNyt3xR.js";import"./user-PSLB04mF.js";const I=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],B=p("arrow-down-left",I);const P=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],T=p("calendar-clock",P);const O=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Y=p("calendar-days",O),F=({book:t})=>t?e.jsxs(S,{target:"_blank",to:`/books/${t._id}`,className:"mt-3 p-3 bg-orange-50/80 rounded-xl border border-orange-100 flex items-start sm:items-center gap-3 animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-10 h-14 flex-shrink-0 bg-gray-200 rounded-md overflow-hidden shadow-sm",children:e.jsx("img",{src:t.coverImageUrl,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-orange-600 mb-0.5",children:[e.jsx(M,{size:12,className:"stroke-[2.5]"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Offered for Swap"})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 truncate leading-tight",title:t.title,children:t.title}),e.jsxs("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:["by ",t.author]})]})]}):null,H=({request:t,isIncoming:a})=>{const d=k(),[s,c]=m.useState(!1),{register:i,handleSubmit:r,formState:{errors:n},reset:C}=q(),u=t.status==="pending",o=a?t.requester:t.owner,z=[o?.city,o?.state].filter(Boolean).join(", ")||"Unknown Location",h=t.dueDate?new Date(t.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):null,D=l=>{d(j({requestId:t._id,action:"approved",pickupInfo:{location:l.location,datetime:l.datetime,note:l.note}}))},f=l=>{d(j({requestId:t._id,action:l})),C(),c(!1)};return e.jsx("div",{className:"group bg-white rounded-2xl p-4 border border-gray-100 shadow-sm hover:shadow-md hover:border-orange-200 transition-all duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-5",children:[e.jsx("div",{className:"w-full sm:w-24 h-32 flex-shrink-0 bg-gray-100 rounded-xl overflow-hidden relative",children:e.jsx("img",{src:t.book.coverImageUrl,alt:t.book.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between min-w-0",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[R(t.type),h&&e.jsxs("span",{className:"text-xs font-medium text-red-600 bg-red-50 px-2 py-0.5 rounded flex items-center gap-1 border border-red-100",children:[e.jsx(T,{size:12})," Due: ",h]})]}),e.jsx("div",{className:"hidden sm:block",children:v(t.status)})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 leading-tight truncate",children:t.book.title}),e.jsxs("p",{className:"text-sm text-gray-500 mb-3 truncate",children:["by ",t.book.author]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 p-2 rounded-xl w-fit max-w-full",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 border border-gray-200",children:o?.avatar?e.jsx("img",{src:o.avatar?.url||o.avatar,alt:o?.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-black text-white flex items-center justify-center text-xs font-bold",children:o?.name?.[0]?.toUpperCase()||"U"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-gray-900",children:a?"Request from":"Owner"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 truncate",children:[e.jsx("span",{className:"font-medium text-gray-700 truncate",children:o?.name||"Unknown"}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-0.5 truncate",children:[e.jsx(w,{size:10})," ",z]})]})]})]}),t.type==="swap"&&t.offeredBook&&e.jsx(F,{book:t.offeredBook})]}),t.notes&&!s&&e.jsxs("div",{className:"mt-3 flex gap-2 items-start text-xs text-gray-600 italic",children:[e.jsx(A,{size:14,className:"text-orange-400 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"line-clamp-2",children:['"',t.notes,'"']})]})]}),e.jsxs("div",{className:`flex sm:flex-col justify-end gap-2 sm:border-l sm:border-gray-100 sm:pl-5 flex-shrink-0 ${s?"w-full sm:w-72":"sm:w-32"}`,children:[e.jsx("div",{className:"sm:hidden mr-auto",children:v(t.status)}),a&&u&&!s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!0),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 bg-black text-white px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-gray-800 transition-colors",children:[e.jsx(_,{size:14})," Accept"]}),e.jsxs("button",{onClick:()=>f("rejected"),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 border border-gray-200 text-gray-600 px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-gray-50 transition-colors",children:[e.jsx(E,{size:14})," Decline"]})]}):!a&&u?e.jsx("button",{onClick:()=>f("cancelled"),className:"w-full border border-gray-200 text-gray-500 px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-gray-50 hover:text-red-500 transition-colors",children:"Cancel"}):!s&&e.jsx("button",{className:"w-full flex items-center justify-center gap-2 text-gray-400 hover:text-orange-500 transition-colors py-2",children:e.jsx(U,{size:20})}),s&&e.jsxs("form",{className:"flex flex-col gap-3 animate-in fade-in slide-in-from-right-4 duration-300",onSubmit:l=>l.preventDefault(),children:[e.jsx("div",{className:"text-xs font-bold text-gray-900 uppercase",children:"Pickup Details"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Pickup Location...",className:`w-full pl-9 pr-3 py-2 bg-gray-50 border rounded-lg text-xs focus:outline-none focus:ring-1 focus:ring-orange-500 
                    ${n.location?"border-red-500 focus:ring-red-500":"border-gray-200"}`,...i("location",{required:"Pickup location is required"})}),n.location&&e.jsx("p",{className:"text-[10px] text-red-500 mt-1 ml-1",children:n.location.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:14,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"datetime-local",className:`w-full pl-9 pr-3 py-2 bg-gray-50 border rounded-lg text-xs focus:outline-none focus:ring-1 focus:ring-orange-500 text-gray-600
                    ${n.datetime?"border-red-500 focus:ring-red-500":"border-gray-200"}`,...i("datetime",{required:"Date and time is required"})}),n.datetime&&e.jsx("p",{className:"text-[10px] text-red-500 mt-1 ml-1",children:n.datetime.message})]}),e.jsxs("div",{children:[e.jsx("textarea",{placeholder:"Add a note (Required). You can mention phone number or any other details.",className:`w-full p-3 bg-gray-50 border rounded-lg text-xs focus:outline-none focus:ring-1 focus:ring-orange-500 resize-none h-16
                    ${n.note?"border-red-500 focus:ring-red-500":"border-gray-200"}`,...i("note",{required:"Please add a note for the borrower"})}),n.note&&e.jsx("p",{className:"text-[10px] text-red-500 mt-1 ml-1",children:n.note.message})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{type:"button",onClick:r(D),className:"flex-1 bg-black text-white py-2 rounded-lg text-xs font-bold uppercase hover:bg-green-600 transition-colors",children:"Confirm"}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 bg-white border border-gray-200 text-gray-600 py-2 rounded-lg text-xs font-bold uppercase hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})]})})},xe=()=>{const t=k(),a=y(r=>r.requests),d=y(r=>r.users),[s,c]=m.useState("incoming"),i=s==="incoming"?a.incomingRequests:a.outgoingRequests;return m.useEffect(()=>(d.isAuthorized&&(t(g()),t(N()),s==="incoming"&&t(b()),x.on("notification:new",r=>{r.type==="REQUEST_CREATED"&&t(g())}),x.on("request:updated",()=>{t(g()),t(N())})),()=>{x.off("notification:new"),x.off("request:updated")}),[d.isAuthorized,t,s]),m.useEffect(()=>{s==="incoming"&&t(b())},[s,t]),e.jsxs("div",{className:"w-screen min-h-screen px-6 lg:px-12 bg-white text-gray-900 pb-20",children:[e.jsx(L,{}),e.jsxs("div",{className:"max-w-3xl mx-auto pt-8 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Book Requests"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your swaps and lending history."}),e.jsxs("div",{className:"flex gap-8 mt-8 border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>c("incoming"),className:`pb-3 text-sm font-bold uppercase tracking-wide border-b-2 transition-all flex items-center gap-2 ${s==="incoming"?"border-orange-500 text-orange-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[e.jsx(B,{size:18}),"Incoming",e.jsx("span",{className:"ml-1 bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded text-[10px]",children:a.incomingRequests?.length||0})]}),e.jsxs("button",{onClick:()=>c("sent"),className:`pb-3 text-sm font-bold uppercase tracking-wide border-b-2 transition-all flex items-center gap-2 ${s==="sent"?"border-orange-500 text-orange-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[e.jsx($,{size:18}),"Sent",e.jsx("span",{className:"ml-1 bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded text-[10px]",children:a.outgoingRequests?.length||0})]})]})]}),e.jsx("div",{className:"max-w-3xl mx-auto space-y-4 mt-6",children:i&&i.length>0?i.map(r=>e.jsx(H,{request:r,isIncoming:s==="incoming"},r._id)):e.jsxs("div",{className:"text-center py-20 bg-gray-50 rounded-3xl mt-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(M,{className:"text-gray-300",size:24})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"No requests found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:s==="incoming"?"You haven't received any requests yet.":"You haven't sent any requests yet."})]})})]})};export{xe as default};
