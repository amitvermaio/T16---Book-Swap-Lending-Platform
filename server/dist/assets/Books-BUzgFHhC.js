import{R as y,r as d,a as C,b as w,c as Y,j as t,s as R,d as M,e as P,f as z,g as A,h as B,L as F}from"./index-D6hQ08Y0.js";import{a as k}from"./booksAction-DGx6rorU.js";import{B as H}from"./BookCard-g_CEm0NB.js";import{N as O}from"./Navbar-B8S6qRoR.js";import{a as I,C as $,A as W,S as U}from"./constants-DytKgnBF.js";import{S as q}from"./search-DM_tT_hn.js";import{C as N}from"./chevron-down-C4ZA3iw4.js";import{C as E}from"./check-DIomLv4k.js";import{X as G}from"./x-BL0ellVK.js";import{M as L}from"./map-pin-B2ya93t5.js";import{c as V}from"./createLucideIcon-C9Hrp4nZ.js";import{P as K}from"./plus-CKVMXV1q.js";import"./arrow-up-right-DgZ_bVwA.js";import"./heart-4mg5nvMK.js";import"./user-PSLB04mF.js";import"./check-check-CE3MAPcn.js";import"./star-DZToScwE.js";import"./book-open-CQ8IbAVz.js";import"./menu-BUNyt3xR.js";import"./clock-JQ9xzxrc.js";import"./circle-check-big-D7MaoHrP.js";const Q=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],X=V("rotate-ccw",Q);var T=function(i,o){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var s in e)e.hasOwnProperty(s)&&(r[s]=e[s])},T(i,o)};function J(i,o){T(i,o);function r(){this.constructor=i}i.prototype=o===null?Object.create(o):(r.prototype=o.prototype,new r)}var x=function(){return x=Object.assign||function(o){for(var r,e=1,s=arguments.length;e<s;e++){r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(o[l]=r[l])}return o},x.apply(this,arguments)};function Z(i,o,r,e){var s,l=!1,c=0;function u(){s&&clearTimeout(s)}function a(){u(),l=!0}typeof o!="boolean"&&(e=r,r=o,o=void 0);function p(){var f=this,v=Date.now()-c,j=arguments;if(l)return;function g(){c=Date.now(),r.apply(f,j)}function n(){s=void 0}e&&!s&&g(),u(),e===void 0&&v>i?g():o!==!0&&(s=setTimeout(e?n:g,e===void 0?i-v:i))}return p.cancel=a,p}var m={Pixel:"Pixel",Percent:"Percent"},_={unit:m.Percent,value:.8};function D(i){return typeof i=="number"?{unit:m.Percent,value:i*100}:typeof i=="string"?i.match(/^(\d*(\.\d+)?)px$/)?{unit:m.Pixel,value:parseFloat(i)}:i.match(/^(\d*(\.\d+)?)%$/)?{unit:m.Percent,value:parseFloat(i)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),_):(console.warn("scrollThreshold should be string or number"),_)}var ee=(function(i){J(o,i);function o(r){var e=i.call(this,r)||this;return e.lastScrollTop=0,e.actionTriggered=!1,e.startY=0,e.currentY=0,e.dragging=!1,e.maxPullDownDistance=0,e.getScrollableTarget=function(){return e.props.scrollableTarget instanceof HTMLElement?e.props.scrollableTarget:typeof e.props.scrollableTarget=="string"?document.getElementById(e.props.scrollableTarget):(e.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},e.onStart=function(s){e.lastScrollTop||(e.dragging=!0,s instanceof MouseEvent?e.startY=s.pageY:s instanceof TouchEvent&&(e.startY=s.touches[0].pageY),e.currentY=e.startY,e._infScroll&&(e._infScroll.style.willChange="transform",e._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},e.onMove=function(s){e.dragging&&(s instanceof MouseEvent?e.currentY=s.pageY:s instanceof TouchEvent&&(e.currentY=s.touches[0].pageY),!(e.currentY<e.startY)&&(e.currentY-e.startY>=Number(e.props.pullDownToRefreshThreshold)&&e.setState({pullToRefreshThresholdBreached:!0}),!(e.currentY-e.startY>e.maxPullDownDistance*1.5)&&e._infScroll&&(e._infScroll.style.overflow="visible",e._infScroll.style.transform="translate3d(0px, "+(e.currentY-e.startY)+"px, 0px)")))},e.onEnd=function(){e.startY=0,e.currentY=0,e.dragging=!1,e.state.pullToRefreshThresholdBreached&&(e.props.refreshFunction&&e.props.refreshFunction(),e.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){e._infScroll&&(e._infScroll.style.overflow="auto",e._infScroll.style.transform="none",e._infScroll.style.willChange="unset")})},e.onScrollListener=function(s){typeof e.props.onScroll=="function"&&setTimeout(function(){return e.props.onScroll&&e.props.onScroll(s)},0);var l=e.props.height||e._scrollableNode?s.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!e.actionTriggered){var c=e.props.inverse?e.isElementAtTop(l,e.props.scrollThreshold):e.isElementAtBottom(l,e.props.scrollThreshold);c&&e.props.hasMore&&(e.actionTriggered=!0,e.setState({showLoader:!0}),e.props.next&&e.props.next()),e.lastScrollTop=l.scrollTop}},e.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:r.dataLength},e.throttledOnScrollListener=Z(150,e.onScrollListener).bind(e),e.onStart=e.onStart.bind(e),e.onMove=e.onMove.bind(e),e.onEnd=e.onEnd.bind(e),e}return o.prototype.componentDidMount=function(){if(typeof this.props.dataLength>"u")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},o.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},o.prototype.componentDidUpdate=function(r){this.props.dataLength!==r.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},o.getDerivedStateFromProps=function(r,e){var s=r.dataLength!==e.prevDataLength;return s?x(x({},e),{prevDataLength:r.dataLength}):null},o.prototype.isElementAtTop=function(r,e){e===void 0&&(e=.8);var s=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,l=D(e);return l.unit===m.Pixel?r.scrollTop<=l.value+s-r.scrollHeight+1:r.scrollTop<=l.value/100+s-r.scrollHeight+1},o.prototype.isElementAtBottom=function(r,e){e===void 0&&(e=.8);var s=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,l=D(e);return l.unit===m.Pixel?r.scrollTop+s>=r.scrollHeight-l.value:r.scrollTop+s>=l.value/100*r.scrollHeight},o.prototype.render=function(){var r=this,e=x({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),s=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),l=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return y.createElement("div",{style:l,className:"infinite-scroll-component__outerdiv"},y.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(c){return r._infScroll=c},style:e},this.props.pullDownToRefresh&&y.createElement("div",{style:{position:"relative"},ref:function(c){return r._pullDown=c}},y.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!s&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},o})(d.Component);const te=()=>{const i=C(),o=w(n=>n.filters),{isAuthorized:r}=w(n=>n.users),[e,s]=d.useState(null),[l,c]=d.useState(""),u=d.useRef(null),a=d.useRef(!0);d.useEffect(()=>{if(a.current){a.current=!1;return}const n=setTimeout(()=>{i(Y()),i(k())},1e3);return()=>{clearTimeout(n)}},[o,i]),d.useEffect(()=>{const n=h=>{u.current&&!u.current.contains(h.target)&&s(null)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const p=n=>{s(e===n?null:n)},f=(n,h)=>{if(n==="sort"){i(M(h)),s(null);return}if(n==="location"){i(P(h)),s(null);return}i(z({category:n,value:h})),s(null)},v=n=>{n.stopPropagation(),i(A()),c("")},j=n=>{i(R(n.target.value))},g=()=>{i(B()),c(""),s(null)};return t.jsxs("div",{className:"w-full mt-2 sm:mt-10 bg-white p-4 rounded-2xl shadow-sm border border-gray-100 font-sans",ref:u,children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-orange-500",children:t.jsx(q,{size:20,strokeWidth:2.5})}),t.jsx("input",{type:"text",value:o.searchTerm,onChange:j,placeholder:"Search by title, author, or ISBN",className:"w-full bg-[#FDFBF7] hover:bg-gray-50 focus:bg-white focus:ring-2 focus:ring-orange-100 border border-orange-200 outline-none rounded-xl py-3.5 pl-12 pr-4 text-gray-900 placeholder-orange-300 text-sm transition-all shadow-inner-sm"})]}),t.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center justify-between gap-4 relative",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[{label:"Genre",key:"genre",options:I},{label:"Condition",key:"condition",options:$},{label:"Availability",key:"availabilityType",options:W}].map(n=>{const h=o[n.key],S=!!h;return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>p(n.key),className:`group flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-full transition-all border
                    ${S||e===n.key?"bg-orange-100 border-orange-200 text-orange-600":"bg-gray-100 border-gray-200 hover:bg-gray-100 text-black"}`,children:[S?h:n.label,t.jsx(N,{size:14,className:`transition-transform duration-200 ${e===n.key?"rotate-180":""} 
                    ${S?"text-orange-400":"text-black"}`})]}),e===n.key&&t.jsx("div",{className:"absolute top-full mt-2 left-0 w-48 max-h-64 overflow-y-auto bg-white rounded-xl shadow-xl border border-gray-100 z-50 p-1 scrollbar-thin scrollbar-thumb-gray-200 scrollbar-track-transparent",children:n.options.map(b=>t.jsxs("button",{onClick:()=>f(n.key,b),className:"w-full text-left px-3 capitalize py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 rounded-lg transition-colors flex items-center justify-between",children:[b,h===b&&t.jsx(E,{size:14,className:"text-orange-500"})]},b))})]},n.key)}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>p("location"),className:`flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-full transition-all border
                ${o.location?"bg-orange-50 border-orange-100 text-orange-600":"bg-[#FCFCFC] border-transparent hover:bg-gray-100 text-gray-900"}`,children:["Location: ",t.jsx("span",{className:o.location?"text-orange-600":"text-gray-900",children:o.location||"Any"}),o.location?t.jsx(G,{size:14,className:"ml-1 cursor-pointer hover:text-orange-800",onClick:v}):t.jsx(N,{size:14,className:"text-gray-400"})]}),e==="location"&&t.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 bg-white rounded-xl shadow-xl border border-gray-100 z-50 p-3",children:[t.jsxs("div",{className:"relative mb-3",children:[t.jsx(L,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),t.jsx("input",{autoFocus:!0,type:"text",placeholder:"Enter city or zip...",className:"w-full bg-gray-50 text-sm pl-9 pr-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:border-orange-300 focus:ring-2 focus:ring-orange-100 text-gray-900",value:l,onChange:n=>c(n.target.value),onKeyDown:n=>{n.key==="Enter"&&f("location",l)}})]}),r&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 px-1",children:"Quick Select"}),t.jsxs("button",{onClick:()=>f("location","Nearby"),className:"w-full text-left px-3 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 rounded-lg flex items-center gap-2",children:[t.jsx(L,{size:14})," Nearby Books",o.location==="Nearby"&&t.jsx(E,{size:14,className:"text-orange-500 ml-auto"})]})]})]})]}),t.jsxs("button",{onClick:g,className:"flex items-center gap-1.5 px-3 py-2 text-xs font-semibold text-gray-400 hover:text-red-500 transition-colors ml-2",title:"Reset all filters",children:[t.jsx(X,{size:14}),"Clear"]})]}),t.jsxs("div",{className:"relative flex items-center gap-2 ml-auto sm:ml-0 border-l pl-4 border-gray-100",children:[t.jsx("span",{className:"text-gray-400 text-sm font-normal hidden sm:inline-block",children:"Sort by:"}),t.jsxs("button",{onClick:()=>p("sort"),className:"flex items-center gap-1 text-gray-900 text-sm font-semibold hover:text-black group",children:[o.sort,t.jsx(N,{size:16,className:`text-gray-900 stroke-[3px] transition-transform ${e==="sort"?"rotate-180":""}`})]}),e==="sort"&&t.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 z-50 p-1",children:U.map(n=>t.jsxs("button",{onClick:()=>f("sort",n),className:`w-full text-left px-3 py-2 text-sm rounded-lg transition-colors flex items-center justify-between
                    ${o.sort===n?"bg-orange-50 text-orange-700 font-medium":"text-gray-900 hover:bg-gray-50"}`,children:[n,o.sort===n&&t.jsx(E,{size:14,className:"text-orange-500"})]},n))})]})]})]})},Se=()=>{const i=C(),{books:o,hasMore:r,loading:e}=w(a=>a.books),s=w(a=>a.users),[l,c]=d.useState(window.innerHeight-180);d.useEffect(()=>{const a=()=>{const p=window.innerWidth<768?320:180;c(window.innerHeight-p)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),d.useEffect(()=>{o.length===0&&i(k())},[i,o.length]);const u=()=>{!e&&r&&(console.log("Fetching next page..."),i(k()))};return t.jsxs("div",{className:"w-full min-h-screen px-4 sm:px-6 lg:px-12 bg-white pb-10 overflow-hidden",children:[t.jsx(O,{}),t.jsxs("div",{className:"w-full mt-5",children:[t.jsxs("div",{className:"w-full flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"w-full md:w-auto",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl tracking-tighter font-semibold",children:"All Books"}),t.jsxs("p",{className:"tracking-wider text-orange-500 flex items-center flex-wrap gap-2 mt-2 text-sm sm:text-base",children:["Discover books shared by readers near you",t.jsx("span",{className:"hidden sm:inline-block w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),t.jsx("span",{className:"tracking-wide font-bold text-black",children:"1,250+ books available."})]})]}),t.jsx("div",{className:"w-full md:w-auto",children:t.jsxs(F,{to:s?.isAuthorized?"/add-book":"/sign-in",className:`\r
                group flex items-center justify-center md:justify-start gap-2 \r
                w-full md:w-auto\r
                bg-orange-500 hover:bg-orange-600 text-white \r
                px-5 py-3 md:px-4 md:py-2.5 rounded-xl \r
                font-semibold text-sm transition-all duration-200 \r
                shadow-md hover:shadow-lg active:scale-95 tracking-tighter\r
              `,children:[t.jsx(K,{size:18,strokeWidth:3,className:"group-hover:rotate-90 transition-transform duration-200"}),t.jsx("span",{children:"Add Book"})]})})]}),t.jsx(te,{}),t.jsx(ee,{className:"hide-scrollbar",dataLength:o.length,next:u,hasMore:r,height:l,loader:t.jsx("p",{className:"text-center py-6 text-gray-400",children:"Loading more books..."}),endMessage:t.jsx("p",{className:"text-center py-6 text-gray-400",children:"ðŸŽ‰ Youâ€™ve reached the end"}),children:t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6 py-8",children:o.length>0?o.map(a=>t.jsx("div",{className:"flex justify-center",children:t.jsx(H,{...a})},a._id)):o.length===0&&!e?t.jsx("p",{className:"col-span-full w-full h-40 flex items-center justify-center text-gray-500",children:"No books found."}):t.jsx("div",{className:"col-span-full w-full h-40 flex items-center justify-center text-gray-400",children:"Loading library..."})})})]})]})};export{Se as default};
