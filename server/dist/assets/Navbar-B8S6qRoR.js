import{p as b,U as k,V as C,j as e,a as u,b as j,r as m,x as g,W as L,X as S,C as N,L as d,Y as y,Z as z}from"./index-D6hQ08Y0.js";import{C as _}from"./check-check-CE3MAPcn.js";import{S as p}from"./star-DZToScwE.js";import{B as A}from"./book-open-CQ8IbAVz.js";import{c as f}from"./createLucideIcon-C9Hrp4nZ.js";import{L as M,a as E,M as R}from"./menu-BUNyt3xR.js";import{U as D}from"./user-PSLB04mF.js";import{X as I}from"./x-BL0ellVK.js";const O=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],v=f("bell",O);const B=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],$=f("move-right",B);const U=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],F=f("settings",U),T=()=>async a=>{try{const{data:t}=await b.get("/notifications");t.notifications&&a(k(t.notifications))}catch(t){console.error("Failed to fetch notifications",t)}},q=()=>async a=>{try{await b.patch("/notifications/read-all",{}),a(C())}catch(t){console.error(t)}},w="/assets/Logo-CXuyVzDx.png",P=({notifications:a,onMarkRead:t})=>e.jsxs("div",{className:"absolute right-0 top-12 w-80 bg-white rounded-xl shadow-xl border border-gray-100 py-2 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-50 flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900",children:"Notifications"}),a.length>0&&e.jsxs("button",{onClick:t,className:"text-[10px] flex items-center gap-1 font-bold text-orange-600 hover:text-orange-700 transition-colors",children:[e.jsx(_,{size:12})," Mark all read"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto custom-scrollbar",children:a.length>0?a.map((s,r)=>{const n=s.type==="RATING_RECEIVED";return e.jsxs("div",{className:`px-4 py-3 hover:bg-gray-50 border-b border-gray-50 last:border-0 flex gap-3 transition-colors ${s.isRead?"":"bg-orange-50/50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-md border shadow-sm flex-shrink-0 flex items-center justify-center 
                  ${n?"bg-yellow-50 border-yellow-100 text-yellow-500":"bg-white border-gray-100 text-orange-600"}`,children:n?e.jsx(p,{size:18,fill:"currentColor"}):e.jsx(A,{size:18})}),e.jsxs("div",{className:"flex-1",children:[n?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs font-bold text-gray-800",children:[s.data.senderName||"Someone"," rated you"]}),e.jsxs("div",{className:"flex items-center gap-0.5 my-1",children:[[...Array(5)].map((o,l)=>e.jsx(p,{size:10,className:`${l<(s.data.score||0)?"text-yellow-400 fill-yellow-400":"text-gray-200 fill-gray-200"}`},l)),e.jsxs("span",{className:"text-[10px] text-gray-400 ml-1 font-medium",children:["(",s.data.score,".0)"]})]}),s.data.comment&&e.jsxs("p",{className:"text-xs text-gray-600 italic border-l-2 border-gray-200 pl-2 mb-1",children:['"',s.data.comment,'"']})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs font-bold text-gray-800 uppercase",children:s.type?.replace("_"," ")||"Notification"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:s.message})]}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1",children:[new Date(s.createdAt).toLocaleDateString()," â€¢"," ",new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},s._id||r)}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-400 text-xs flex flex-col items-center gap-2",children:[e.jsx(v,{size:20,className:"text-gray-200"}),"No new notifications"]})})]}),V=({isAuthorized:a,closeProfile:t})=>{const s=u(),{list:r,unreadCount:n}=j(i=>i.notifications),[o,l]=m.useState(!1);m.useEffect(()=>{if(a){const i=x=>{s(L(x)),x.type==="REQUEST_CREATED"&&s(S()),N(x.message,{icon:"ðŸ””"})};return g.on("notification:new",i),g.on("rating:new",i),()=>{g.off("notification:new",i),g.off("rating:new",i)}}},[a,s]);const c=()=>{l(!o),o===!1&&t&&t()},h=()=>{s(q())};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:c,className:"relative group text-black hover:text-orange-500 transition-colors p-1",children:[e.jsx(v,{className:"h-5 w-5",strokeWidth:2}),n>0&&e.jsx("span",{className:"absolute top-0 right-0 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ring-2 ring-white",children:n>9?"9+":n})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>l(!1)}),e.jsx(P,{notifications:r,onMarkRead:h})]})]})},W=[{path:"/books",label:"Browse Books"},{path:"/requests",label:"Requests"},{path:"/tracking",label:"Tracking"},{path:"/about",label:"About"}],X=({links:a})=>e.jsx("div",{className:"hidden lg:flex font-Inter items-center gap-12 text-xs tracking-tight text-black uppercase",children:a.map(t=>e.jsx(y,{to:t.path,className:({isActive:s})=>s?"underline underline-offset-4 font-bold":"text-black hover:text-orange-600 transition-colors",children:t.label},t.path))}),G=({isOpen:a,closeSidebar:t,links:s})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed top-0 left-0 h-full w-64 bg-[#fbf7f3] shadow-lg z-50 transition-transform duration-300 ${a?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-black/10",children:[e.jsx("img",{src:w,alt:"Logo",className:"h-10 object-contain"}),e.jsx("button",{onClick:t,children:e.jsx(I,{className:"h-6 w-6 text-black"})})]}),e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-8 text-black font-Inter uppercase tracking-tight",children:s.map(r=>e.jsx(y,{to:r.path,onClick:t,className:({isActive:n})=>n?"text-orange-600 font-bold":"",children:r.label},r.path))})]}),a&&e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black/30 z-40 lg:hidden"})]}),te=()=>{const[a,t]=m.useState(!1),[s,r]=m.useState(!1),n=u(),{user:o,isAuthorized:l,role:c}=j(x=>x.users),h=W;m.useEffect(()=>{l&&n(T())},[l,n]);const i=()=>{localStorage.removeItem("BookSwap_Token"),n(z()),N.success("Logged Out Successfully!"),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"w-full border-b border-black/10 relative z-30 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between py-7 px-4 xl:px-0",children:[e.jsx(d,{to:"/",className:"flex items-center",children:e.jsx("img",{src:w,alt:"Logo",className:"h-10 object-contain"})}),e.jsx(X,{links:h}),e.jsxs("div",{className:"flex items-center gap-4",children:[l?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{isAuthorized:l,closeProfile:()=>r(!1)}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>r(!s),className:`w-10 h-10 rounded-full flex items-center justify-center overflow-hidden transition-all duration-200 border border-gray-200 outline-none
                      ${s?"ring-2 ring-orange-500 ring-offset-2":"hover:ring-2 hover:ring-orange-500 hover:ring-offset-2"}
                    `,children:o?.avatar?e.jsx("img",{src:o.avatar.url||o.avatar,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-black text-white flex items-center justify-center font-semibold text-sm",children:o?.name?o.name.charAt(0).toUpperCase():"U"})}),s&&e.jsxs("div",{className:"absolute right-0 mt-3 w-56 bg-white rounded-xl shadow-xl border border-gray-100 py-3 animate-in fade-in zoom-in-95 duration-200 z-50",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-gray-100 mb-2",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900 truncate",children:o?.name||"User"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-gray-500 truncate",children:o?.email||"user@example.com"}),(c==="admin"||c==="superadmin")&&e.jsx("span",{className:"text-[10px] bg-orange-100 text-orange-600 px-1.5 py-0.5 rounded font-bold uppercase",children:c})]})]}),e.jsxs("div",{className:"flex flex-col",children:[(c==="admin"||c==="superadmin")&&e.jsxs(d,{to:"/admin/dashboard",onClick:()=>r(!1),className:"flex items-center px-4 py-2.5 text-sm text-orange-600 font-bold hover:bg-orange-50 transition-colors",children:[e.jsx(M,{className:"w-4 h-4 mr-3"}),"Admin Dashboard"]}),e.jsxs(d,{to:`/profile/${o?._id}`,onClick:()=>r(!1),className:"flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors",children:[e.jsx(D,{className:"w-4 h-4 mr-3"}),"My Profile"]}),e.jsxs(d,{to:"/settings",onClick:()=>r(!1),className:"flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors",children:[e.jsx(F,{className:"w-4 h-4 mr-3"}),"Settings"]}),e.jsx("div",{className:"h-px bg-gray-100 my-2 mx-4"}),e.jsxs("button",{onClick:i,className:"flex w-full items-center px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(E,{className:"w-4 h-4 mr-3"}),"Sign out"]})]})]})]})]}):e.jsxs(d,{to:"/sign-in",className:"bg-black text-white rounded-full px-5 py-2 text-xs sm:text-sm font-medium transition-transform hover:scale-105",children:[e.jsx("span",{className:"hidden sm:inline",children:"Sign In"}),e.jsx($,{className:"inline-block sm:ml-2 h-4 w-4"})]}),e.jsx("button",{onClick:()=>t(!0),className:"lg:hidden",children:e.jsx(R,{className:"h-6 w-6 text-black",strokeWidth:2})})]})]})}),e.jsx(G,{isOpen:a,closeSidebar:()=>t(!1),links:h})]})};export{te as N};
